---
title: "mediator"
subtitle: ""  
author: "Jordan Creed"
date: "Best Statistical Practices 2020"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    seal: false
    nature:
      titleSlideClass: ["bottom", "left"]
      slideNumberFormat: "%current%"
      highlightStyle: github
      highlightLines: true
      ratio: "16:9"
      countIncrementalSlides: true
---

```{r xaringan-themer, include = FALSE}
library(xaringanthemer)
duo_accent(primary_color = "#F09749", secondary_color = "skyblue")
# mono_accent(base_color = "skyblue")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  fig.width = 10, fig.height = 6, fig.retina = 2,
  warning = FALSE, message = FALSE
)

xaringanExtra::use_xaringan_extra(c("animate_css", "text_poster", "panelset"))
xaringanExtra::use_tachyons()
```

class: center middle hide-count hide-logo
background-image: url(figures/moffittlogo.png) 
background-size: 15%
background-position: bottom 5% right 5%

<div class="talk-logo"></div>

.talk-meta[
  .talk-title[# mediator <br> <br> .smaller[an R package for conducting <br> causal mediation analyses]]

  .talk-author[Jordan Creed]
  
  .talk-date[<img src="figures/twitter_logo.svg" alt="Twitter logo" width="24px"/> @jhcreed]
]

---

## Mediation analysis

Examines an exposure and outcome through an intermediate variable (mediator) 

Causal relationship 
+ Understanding the mechanics behind an association 
+ NOT prediction
    
Estimate the direct and indirect effects 

.h-center[
![](figures/basic_example_dag.png)
]

---

## Diected Acyclic Graphs (DAGs)

.w-75.h-center[
![](figures/example_dag_2.png)
]

DAGs contain variables of interest and common causes

Time ordered 

Quickly assess assocations between variables 

Rules for reading DAGs 
+ .accent-blue[ Modern Epidemiology - Chapter 12 ]
+ .accent-blue[ Causal Inference - https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/ ] 

---

## Classic mediation analysis

Baron and Kenny aka the product method 
+ https://www.sesp.org/files/The%20Moderator-Baron.pdf
+ Over 90,000 citations 

Criteria to be a mediator: 
+ Changing the exposure change the mediator (Race -> Access/ QoC) 
+ The mediator affect the outcome (Access / Qoc -> Lethal outcomes)
+ Changing the exposure change the outcome .accent-blue[ ( `r emo::ji("grimacing")` unless the indirect and direct effects cancel out) ]
+ After controlling for the mediator, the previously significant relationship between the exposure and the outcome is no longer significant .accent-blue[ ( `r emo::ji("grimacing")` unless it partial mediaton) ]

---

## Baron and Kenny approach 

If .accent-orange[X] is the exposure, .accent-orange[ Y ] the outcome, .accent-orange[ M ] the mediator and .accent-orange[ C ] the covariates
+ Y and M are continuous
    
Step 1: Fit E[M] = $\beta_{0}$ + $\beta_{1} a$ + $\beta_{2} c$

Step 2: Fit E[Y] = $\theta_{0}$ + $\theta_{1} a$ + $\theta_{2} m$ + $\theta_{4} c$

Direct effect = $\theta_{1} a$
+ Direct effect is the exposure effect on the outcome at a fixed level of the mediator

Indirect effect = $\theta_{2} \beta_{1}$
+ Indirect effect is the effect on the outcome of changes of the exposure which operate through the mediator

`r emo::ji("point_right")` .accent-blue[Does not accommodate exposure-mediator interactions]

---
class: center middle methods-title

`r xaringanExtra::text_poster(
  "Causal 
  Inference 
  Methods",
  width = "90%",
  height = "80%"
)`

```{css echo=FALSE}
# .strive-to-recruit .text-poster .line-container {
#   color: #000000;
# }
.methods-title {
  background: #87CEEB;
}
```

---

## Allowing exposure-mediator interactions

Step 1: Fit E[M] = $\beta_{0} + \beta_{1} a + \beta_{2} c$ 
+ .accent-blue[same as previously]

Step 2: Fit E[Y] = $\theta_{0} + \theta_{1} a + \theta_{2} m + \theta_{3} am + \theta_{4} c$

.accent-blue[Assuming a binary exposure changing level a^*^ = 0 to a = 1]



> Controlled direct effect = $( \theta_{0} + \theta_{3} m)(a - a^{*})$

> Natural indirect effect = $\{ \theta_{0} + \theta_{3} ( \beta_{0} + \beta_{1} a^{*} + \beta_{2} c) \}(a - a^{*})$

> Natural indirect effect = $( \theta_{2} \beta_{1} + \theta_{3} \beta_{1}a) (a - a^{*})$



`r emo::ji("point_right")` When no exposure-mediator interaction is present, $\theta_{3}$ = 0
+ CDE = NDE = $\theta_{1}$ and NIE = $\theta_{2} \beta_{1}$
+ .accent-blue[Same as the direct and indirect effects in Baron and Kenny]

---

## Mediator != confounder

<!-- example of JAMA paper with bad mediator -->


```{css, echo=FALSE}
.talk-logo {
  width: 480px;
  height: 556px;
  position: absolute;
  top: 5%;
  left: 50%;
  background-image: url('figures/mediator_hex.png');
  background-size: cover;
  background-repeat: no-repeat;
}
.talk-meta {
  #font-family: Overpass;
  position: absolute;
  text-align: left;
  bottom: 10px;
  left: 25px;
}
.talk-author {
  color: #444;
  font-weight: bold;
  font-size: 1.5em;
  line-height: 1em;
}
.talk-date {
  color: #666;
  font-size: 1.25em;
  line-height: 0;
}
.hide-count .remark-slide-number {
  display: none;
}

# sizing 
.w-50 {
  width: 50%;
}
.w-75 {
  width: 75%;
}
.h-center {
  margin: 0 auto;
}

# colors

.accent-other { 
  color: light brilliant orange,
}
.accent-orange { 
  color: #f09749; 
}
.accent-blue { 
  color: skyblue; 
}

```